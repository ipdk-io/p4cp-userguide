

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Running Stratum Unit Tests &mdash; P4 Control Plane  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=eb612f83" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Security" href="../security.html" />
    <link rel="prev" title="Running OVSP4RT Unit Tests" href="running-ovsp4rt-unit-tests.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            P4 Control Plane
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../general.html">General Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../building.html">Building P4 Control Plane</a></li>
<li class="toctree-l1"><a class="reference internal" href="../p4_programs.html">Working with P4 Programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../executables/executables.html">Executables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features.html">Features</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="maintainers.html">Maintainers</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="build-guides.html">Build Guides</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="unit-tests.html">Unit Tests</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="running-krnlmon-unit-tests.html">Running Krnlmon Unit Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="running-ovs-unit-tests.html">Running OVS Unit Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="running-ovsp4rt-unit-tests.html">Running OVSP4RT Unit Tests</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Running Stratum Unit Tests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getting-source-code">Getting source code</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-tests">Running tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#measuring-test-coverage">Measuring test coverage</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changes/changes.html">Changes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">P4 Control Plane</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="maintainers.html">Maintainers</a></li>
          <li class="breadcrumb-item"><a href="unit-tests.html">Unit Tests</a></li>
      <li class="breadcrumb-item active">Running Stratum Unit Tests</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/maintainers/running-stratum-unit-tests.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="running-stratum-unit-tests">
<h1><a class="toc-backref" href="#id4" role="doc-backlink">Running Stratum Unit Tests</a><a class="headerlink" href="#running-stratum-unit-tests" title="Link to this heading"></a></h1>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#running-stratum-unit-tests" id="id4">Running Stratum Unit Tests</a></p>
<ul>
<li><p><a class="reference internal" href="#prerequisites" id="id5">Prerequisites</a></p>
<ul>
<li><p><a class="reference internal" href="#install-bazel" id="id6">Install Bazel</a></p></li>
<li><p><a class="reference internal" href="#install-sde-s" id="id7">Install SDE(s)</a></p></li>
<li><p><a class="reference internal" href="#define-environment-variable-s" id="id8">Define environment variable(s)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#getting-source-code" id="id9">Getting source code</a></p>
<ul>
<li><p><a class="reference internal" href="#p4-control-plane-networking-recipe" id="id10">P4 Control Plane (networking-recipe)</a></p></li>
<li><p><a class="reference internal" href="#standalone-stratum" id="id11">Standalone Stratum</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#running-tests" id="id12">Running tests</a></p>
<ul>
<li><p><a class="reference internal" href="#test-selection" id="id13">Test selection</a></p></li>
<li><p><a class="reference internal" href="#flaky-tests" id="id14">Flaky Tests</a></p></li>
<li><p><a class="reference internal" href="#test-results" id="id15">Test results</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#measuring-test-coverage" id="id16">Measuring test coverage</a></p>
<ul>
<li><p><a class="reference internal" href="#single-test-coverage" id="id17">Single-test coverage</a></p></li>
<li><p><a class="reference internal" href="#multiple-test-coverage" id="id18">Multiple-test coverage</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<section id="prerequisites">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Prerequisites</a><a class="headerlink" href="#prerequisites" title="Link to this heading"></a></h2>
<section id="install-bazel">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Install Bazel</a><a class="headerlink" href="#install-bazel" title="Link to this heading"></a></h3>
<p>The Stratum unit tests run under control of the Bazel build system. You
will need to install the correct version of Bazel in order to run them.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>bazel-4.2.3
</pre></div>
</div>
<p>For maximum performance, you will want to do unit testing on a system
with sufficient resources (cores, memory, disk space) to support
multiple threads and a large Bazel cache, or a build farm with a large
remote cache.</p>
</section>
<section id="install-sde-s">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Install SDE(s)</a><a class="headerlink" href="#install-sde-s" title="Link to this heading"></a></h3>
<p>Build and install the SDEs for the targets you wish to test. You will
need to install all three SDEs (Tofino, DPDK, ES2K) in order to run the
full suite of tests.</p>
<p>You will need to make the following modification to the ES2K SDE after
you install it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ES2K&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>path-to-es2k-sde/share/TARGET
</pre></div>
</div>
<p>The Bazel build uses this file to verify that the SDE pointed to by the
environment variable is for ES2K.</p>
</section>
<section id="define-environment-variable-s">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Define environment variable(s)</a><a class="headerlink" href="#define-environment-variable-s" title="Link to this heading"></a></h3>
<p>You will need to define an environment variable that provides the path
to the install directory for the SDE.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Target</strong></p></th>
<th class="head"><p><strong>Environment Variable</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Tofino</p></td>
<td><p>SDE_INSTALL=path-to-tofino-sde (<em>or</em>)
SDE_INSTALL_TAR=path-to-tarball-containing-tofino-sde</p></td>
</tr>
<tr class="row-odd"><td><p>DPDK</p></td>
<td><p>DPDK_INSTALL=path-to-dpdk-sde (<em>or</em>)
SDE_INSTALL=path-to-dpdk-sde</p></td>
</tr>
<tr class="row-even"><td><p>ES2K</p></td>
<td><p>ES2K_INSTALL=path-to-es2k-sde (<em>or</em>)
SDE_INSTALL=path-to-es2k-sde</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="getting-source-code">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Getting source code</a><a class="headerlink" href="#getting-source-code" title="Link to this heading"></a></h2>
<section id="p4-control-plane-networking-recipe">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">P4 Control Plane (networking-recipe)</a><a class="headerlink" href="#p4-control-plane-networking-recipe" title="Link to this heading"></a></h3>
<p>If you are working with a copy of the full P4 Control Plane, you will
need to change to the Stratum root directory.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>stratum/stratum
</pre></div>
</div>
<p>To confirm that you are in the right directory, check for a file named
WORKSPACE.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>doctor@tardis:~/stratum$<span class="w"> </span>ls<span class="w"> </span>WORKSPACE
WORKSPACE
</pre></div>
</div>
</section>
<section id="standalone-stratum">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Standalone Stratum</a><a class="headerlink" href="#standalone-stratum" title="Link to this heading"></a></h3>
<p>You can run the unit tests on a standalone instance of the Stratum
repository.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/ipdk-io/stratum-dev.git<span class="w"> </span>stratum
<span class="nb">cd</span><span class="w"> </span>stratum
</pre></div>
</div>
</section>
</section>
<section id="running-tests">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">Running tests</a><a class="headerlink" href="#running-tests" title="Link to this heading"></a></h2>
<section id="test-selection">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Test selection</a><a class="headerlink" href="#test-selection" title="Link to this heading"></a></h3>
<section id="single-test">
<h4>Single test<a class="headerlink" href="#single-test" title="Link to this heading"></a></h4>
<p>To run a single test, issue a <strong>bazel test</strong> command specifying the
target test you wish to run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bazel<span class="w"> </span><span class="nb">test</span><span class="w"> </span>//stratum/hal/lib/p4:p4_table_mapper_test
</pre></div>
</div>
<p>Bazel will build the test and its dependencies if they are out of date.
It will then run the test.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>INFO: Analyzed target //stratum/hal/lib/p4:p4_table_mapper_test (2 packages loaded, 4105 targets configured).
INFO: Found 1 test target...
Target //stratum/hal/lib/p4:p4_table_mapper_test up-to-date:
  bazel-bin/stratum/hal/lib/p4/p4_table_mapper_test
INFO: Elapsed time: 10.517s, Critical Path: 9.27s
INFO: 5 processes: 2 internal, 3 linux-sandbox.
INFO: Build completed successfully, 5 total actions

//stratum/hal/lib/p4:p4_table_mapper_test                     PASSED in 0.5s

INFO: Build completed successfully, 5 total actions
</pre></div>
</div>
</section>
<section id="all-tests-in-a-directory">
<h4>All tests in a directory<a class="headerlink" href="#all-tests-in-a-directory" title="Link to this heading"></a></h4>
<p>You can run all the tests in a directory by specifying the target name <strong>all</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bazel<span class="w"> </span><span class="nb">test</span><span class="w"> </span>//stratum/hal/lib/p4:all
</pre></div>
</div>
<p>Abbreviated output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>//stratum/hal/lib/p4:p4_table_mapper_test (cached)            PASSED in 0.5s
//stratum/hal/lib/p4:p4_action_mapper_test                    PASSED in 0.2s
//stratum/hal/lib/p4:p4_config_verifier_test                  PASSED in 0.4s
//stratum/hal/lib/p4:p4_info_manager_test                     PASSED in 0.2s
//stratum/hal/lib/p4:p4_match_key_test                        PASSED in 0.5s
//stratum/hal/lib/p4:p4_static_entry_mapper_test              PASSED in 0.2s
//stratum/hal/lib/p4:p4_write_request_differ_test             PASSED in 0.3s
//stratum/hal/lib/p4:utils_test                               PASSED in 0.3s
</pre></div>
</div>
</section>
<section id="all-tests-in-or-below-a-directory">
<h4>All tests in or below a directory<a class="headerlink" href="#all-tests-in-or-below-a-directory" title="Link to this heading"></a></h4>
<p>You can select a directory and its subdirectories by specifying an ellipsis
(<strong>…</strong>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bazel<span class="w"> </span><span class="nb">test</span><span class="w"> </span>//stratum/glue/...
</pre></div>
</div>
<p>Abbreviated output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>//stratum/glue/gtl:cleanup_test                                PASSED in 0.0s
//stratum/glue/gtl:map_util_test                               PASSED in 0.0s
//stratum/glue/net_util:absl_test                              PASSED in 0.1s
//stratum/glue/net_util:bits_test                              PASSED in 0.9s
//stratum/glue/net_util:ipaddress_test                         PASSED in 0.1s
//stratum/glue/status:status_test                              PASSED in 0.0s
</pre></div>
</div>
</section>
<section id="target-specific-tests">
<h4>Target-specific tests<a class="headerlink" href="#target-specific-tests" title="Link to this heading"></a></h4>
<p>If any of the tests you wish to run is in one of the following
directories, you will need to specify the target to use:</p>
<ul class="simple">
<li><p>//stratum/hal/lib/common</p></li>
<li><p>//stratum/hal/lib/tdi</p></li>
<li><p>//stratum/hal/lib/tdi/dpdk</p></li>
<li><p>//stratum/hal/lib/tdi/es2k</p></li>
<li><p>//stratum/hal/lib/tdi/tofino</p></li>
</ul>
<p>You do this by including the following on the command line. It can go
before or after the target name.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>--define target=&lt;target&gt;
</pre></div>
</div>
<p>where &lt;target&gt; is one of <code class="docutils literal notranslate"><span class="pre">dpdk</span></code>, <code class="docutils literal notranslate"><span class="pre">es2k</span></code>, or <code class="docutils literal notranslate"><span class="pre">tofino</span></code>.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bazel<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--define<span class="w"> </span><span class="nv">target</span><span class="o">=</span>dpdk<span class="w"> </span>//stratum/hal/lib/tdi/dpdk:dpdk_chassis_test
</pre></div>
</div>
</section>
<section id="all-tests-in-a-file">
<h4>All tests in a file<a class="headerlink" href="#all-tests-in-a-file" title="Link to this heading"></a></h4>
<p>You can put a list of targets in a text file:</p>
<p><strong>tofino-tests.txt:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>//stratum/hal/lib/tdi/tofino:tofino_hal_test
//stratum/hal/lib/tdi/tofino:tofino_switch_test
</pre></div>
</div>
<p>And run them using the command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>xargs<span class="w"> </span>-a<span class="w"> </span>tofino-tests.txt<span class="w"> </span>bazel<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--define<span class="w"> </span><span class="nv">target</span><span class="o">=</span>tofino
</pre></div>
</div>
<p>Abbreviated output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>//stratum/hal/lib/tdi/tofino:tofino_hal_test (cached)          PASSED in 0.4s
//stratum/hal/lib/tdi/tofino:tofino_switch_test (cached)       PASSED in 0.4s
</pre></div>
</div>
</section>
<section id="es2k-tests">
<h4>ES2K Tests<a class="headerlink" href="#es2k-tests" title="Link to this heading"></a></h4>
<p>The following is a suggested set of unit tests for ES2K:</p>
<p><strong>es2k-tests.txt</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>//stratum/glue/...
//stratum/hal/lib/p4/...
//stratum/lib/...
//stratum/public/...
//stratum/hal/lib/tdi:all
//stratum/hal/lib/tdi/es2k:es2k_chassis_manager_test
//stratum/hal/lib/tdi/es2k:es2k_hal_test
//stratum/hal/lib/yang...
</pre></div>
</div>
<p>These tests should be run against the ES2K SDE:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>xargs<span class="w"> </span>-a<span class="w"> </span>es2k-tests.txt<span class="w"> </span>bazel<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--define<span class="w"> </span><span class="nv">target</span><span class="o">=</span>es2k
</pre></div>
</div>
</section>
<section id="dpdk-tests">
<h4>DPDK Tests<a class="headerlink" href="#dpdk-tests" title="Link to this heading"></a></h4>
<p>The following is a suggested set of unit tests for DPDK:</p>
<p><strong>dpdk-tests.txt</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>//stratum/glue/...
//stratum/hal/lib/p4/...
//stratum/lib/...
//stratum/public/...
//stratum/hal/lib/tdi:tdi_action_profile_manager_test
//stratum/hal/lib/tdi:tdi_counter_manager_test
//stratum/hal/lib/tdi:tdi_packetio_manager_test
//stratum/hal/lib/tdi:tdi_pipeline_utils_test
//stratum/hal/lib/tdi:tdi_pre_manager_test
//stratum/hal/lib/tdi:tdi_table_manager_test
//stratum/hal/lib/tdi:utils_test
//stratum/hal/lib/tdi/dpdk:dpdk_chassis_manager_test
//stratum/hal/lib/yang/...
</pre></div>
</div>
<p>These tests should be run against the DPDK SDE:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>xargs<span class="w"> </span>-a<span class="w"> </span>dpdk-tests.txt<span class="w"> </span>bazel<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--define<span class="w"> </span><span class="nv">target</span><span class="o">=</span>dpdk
</pre></div>
</div>
</section>
</section>
<section id="flaky-tests">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Flaky Tests</a><a class="headerlink" href="#flaky-tests" title="Link to this heading"></a></h3>
<p>Some of the unit tests are known to be flaky (they fail intermittently).
These tests have been flagged as flaky by specifying <code class="docutils literal notranslate"><span class="pre">tags</span> <span class="pre">=</span> <span class="pre">[&quot;flaky&quot;]</span></code>
in the <code class="docutils literal notranslate"><span class="pre">stratum_cc_test</span></code> rule.</p>
<p>To run a test suite excluding flaky tests:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>xargs<span class="w"> </span>-a<span class="w"> </span>dpdk-tests.txt<span class="w"> </span>bazel<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--define<span class="w"> </span><span class="nv">target</span><span class="o">=</span>dpdk<span class="w"> </span>--test_tag_filters<span class="o">=</span>-flaky
</pre></div>
</div>
</section>
<section id="test-results">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">Test results</a><a class="headerlink" href="#test-results" title="Link to this heading"></a></h3>
<p>Stratum unit tests use the Google Test framework, so it is possible to
generate XML or JSON output by specifying the <code class="docutils literal notranslate"><span class="pre">--gtest_output</span></code> parameter
on the test command line.</p>
<p>I have not found a way to do this through the <code class="docutils literal notranslate"><span class="pre">bazel</span> <span class="pre">test</span></code> command.</p>
</section>
</section>
<section id="measuring-test-coverage">
<h2><a class="toc-backref" href="#id16" role="doc-backlink">Measuring test coverage</a><a class="headerlink" href="#measuring-test-coverage" title="Link to this heading"></a></h2>
<section id="single-test-coverage">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Single-test coverage</a><a class="headerlink" href="#single-test-coverage" title="Link to this heading"></a></h3>
<section id="measuring-coverage">
<span id="measuring-coverage-1"></span><h4>Measuring coverage<a class="headerlink" href="#measuring-coverage" title="Link to this heading"></a></h4>
<p>Unit test code coverage can be measured by means of the <strong>bazel coverage</strong>
command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bazel<span class="w"> </span>coverage<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>--combined_report<span class="o">=</span>lcov<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>--javabase<span class="o">=</span>@bazel_tools//tools/jdk:remote_jdk11<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>//stratum/hal/lib/p4:p4_table_mapper_test
</pre></div>
</div>
<p>Abbreviated output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>//stratum/hal/lib/p4:p4_table_mapper_test                      PASSED in 1.9s
</pre></div>
</div>
</section>
<section id="generating-the-report">
<span id="generating-report-1"></span><h4>Generating the report<a class="headerlink" href="#generating-the-report" title="Link to this heading"></a></h4>
<p>To generate an HTML coverage report:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>genhtml<span class="w"> </span>--output<span class="w"> </span>coverage<span class="w"> </span><span class="se">\</span>
<span class="w">   </span><span class="s2">&quot;</span><span class="k">$(</span>bazel<span class="w"> </span>info<span class="w"> </span>output_path<span class="k">)</span><span class="s2">/_coverage/_coverage_report.dat&quot;</span>
</pre></div>
</div>
<p>Abbreviated output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Overall coverage rate:
  lines......: 62.3% (938 of 1505 lines)
  functions..: 64.0% (174 of 272 functions)
</pre></div>
</div>
</section>
<section id="viewing-the-report">
<span id="viewing-report-1"></span><h4>Viewing the report<a class="headerlink" href="#viewing-the-report" title="Link to this heading"></a></h4>
<p>To view the coverage report, open <strong>coverage/index.html</strong> in a browser:</p>
<p><img alt="image1" src="../_images/stratum-p4-mapper-top-page.png" /></p>
<p>Click the directory name to see the files page:</p>
<p><img alt="image2" src="../_images/stratum-p4-mapper-files-page.png" /></p>
</section>
</section>
<section id="multiple-test-coverage">
<h3><a class="toc-backref" href="#id18" role="doc-backlink">Multiple-test coverage</a><a class="headerlink" href="#multiple-test-coverage" title="Link to this heading"></a></h3>
<section id="measuring-coverage-2">
<span id="id1"></span><h4>Measuring coverage<a class="headerlink" href="#measuring-coverage-2" title="Link to this heading"></a></h4>
<p>To run and measure coverage for all the tests in a directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bazel<span class="w"> </span>coverage<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>--combined_report<span class="o">=</span>lcov<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>--javabase<span class="o">=</span>@bazel_tools//tools/jdk:remote_jdk11<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>//stratum/hal/lib/p4:all
</pre></div>
</div>
<p>Abbreviated output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>//stratum/hal/lib/p4:p4_table_mapper_test (cached)             PASSED in 1.9s
//stratum/hal/lib/p4:p4_action_mapper_test                     PASSED in 1.9s
//stratum/hal/lib/p4:p4_config_verifier_test                   PASSED in 2.6s
//stratum/hal/lib/p4:p4_info_manager_test                      PASSED in 2.0s
//stratum/hal/lib/p4:p4_match_key_test                         PASSED in 2.2s
//stratum/hal/lib/p4:p4_static_entry_mapper_test               PASSED in 2.3s
//stratum/hal/lib/p4:p4_write_request_differ_test              PASSED in 1.7s
//stratum/hal/lib/p4:utils_test                                PASSED in 1.9s
</pre></div>
</div>
</section>
<section id="generating-report-2">
<span id="id2"></span><h4>Generating the report<a class="headerlink" href="#generating-report-2" title="Link to this heading"></a></h4>
<p>To generate an HTML coverage report:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rm<span class="w"> </span>-fr<span class="w"> </span>coverage/
genhtml<span class="w"> </span>--output<span class="w"> </span>coverage<span class="w"> </span><span class="se">\</span>
<span class="w">   </span><span class="s2">&quot;</span><span class="k">$(</span>bazel<span class="w"> </span>info<span class="w"> </span>output_path<span class="k">)</span><span class="s2">/_coverage/_coverage_report.dat&quot;</span>
</pre></div>
</div>
<p>Abbreviated output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Overall coverage rate:
  lines......: 86.7% (1393 of 1607 lines)
  functions..: 82.2% (267 of 325 functions)
</pre></div>
</div>
</section>
<section id="viewing-report-2">
<span id="id3"></span><h4>Viewing the report<a class="headerlink" href="#viewing-report-2" title="Link to this heading"></a></h4>
<p>To view the coverage report, use a browser to open <strong>coverage/index.html</strong>:</p>
<p><img alt="image3" src="../_images/stratum-p4-report-dir-page.png" /></p>
<p>Click the <strong>p4</strong> directory to view the files page:</p>
<p><img alt="image4" src="../_images/stratum-p4-report-files-page.png" /></p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="running-ovsp4rt-unit-tests.html" class="btn btn-neutral float-left" title="Running OVSP4RT Unit Tests" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../security.html" class="btn btn-neutral float-right" title="Security" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2025 Intel Corporation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>